<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
  </head>
  <body>

    <div id="app">
      {{message}}
      <el-upload
         class="upload"
         action=""
         accept=".csv"
         :on-preview="handlePreview"
         :on-remove="handleRemove"
         :file-list="fileList">
        <el-button size="small" type="primary"> upload csv </el-button>
      </el-upload>
      <debug>
      </debug>
    </div>


    <!-- ADD DEPENDENCIES -->     
    <?!= HtmlService.createHtmlOutputFromFile('packages').getContent(); ?>
    <!-- ADD MODULES -->     
    <?!= HtmlService.createHtmlOutputFromFile('sources').getContent(); ?>
    <?!= HtmlService.createHtmlOutputFromFile('debug').getContent(); ?>

    <script>

var app = new Vue({
  el: '#app',
  data:{
    message:'hello world',
    fileList:[],
  },     
  methods: {
    handleRemove(file, fileList){
      //       console.log(file, fileList);
    },
    handlePreview(file){
      //       console.log(file);
      this.parseCsv(file.raw);
    },
    parseCsv(file){
      Papa.parse(file, {
        download: false,
        header: true,
        complete:this.parseResults
      });
    },
    parseResults(results){
      let parsedTransactions = [];
      for(var i=0;i<results.data.length;i++){
        parsedTransactions.push(this.parseTransaction('chase-sapphire', results.data[i]))
      }
      console.log(parsedTransactions);
    },
    parseTransaction(account, transaction){
      const newTransaction = {
        'Type': null,
        'TransDate': null,
        'PostDate': null,
        'Description': null,
        'Amount': null,
        'Identifier': null,
        'Account': account,
      }

      const keys = Object.keys(transaction);

      const source = accountsSettings[account]; 

      for(var i=0;i<keys.length;i++){
        newTransaction[source.headerMap[keys[i]]] = transaction[keys[i]];
      }

      return newTransaction;
    },
  },
});

    </script>
  </body>
</html>
